<!doctype html>
<html lang="es">
<head>
  <!-- SEO -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="description" content="Reproductor PWA, rápido y responsive.">
  <title>Radios del Perú</title>

  <!-- PWA -->
  <link rel="manifest" href="./manifest.json">
  <link rel="icon" type="image/png" href="./icons/icon-192.png">
  <link rel="shortcut icon" type="image/png" href="./icons/icon-192.png">
  <meta name="theme-color" content="#8a5353">
  <link rel="apple-touch-icon" href="./icons/icon-192.png">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Radios Perú">

  <!-- Fuentes (rendimiento optimizado) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
  <noscript><link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" rel="stylesheet"></noscript>

  <!-- Material Icons (carga diferida) -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" media="print" onload="this.media='all'">
  <noscript><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"></noscript>

  <!-- CSS -->
  <link rel="stylesheet" href="./styles.css">
  
  <!-- HLS.js para soporte de streams HLS (.m3u8) -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.7/dist/hls.min.js"></script>
  
  <!-- JavaScript Principal -->
  <script defer src="./app.js"></script>
  
  <!-- Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then(reg => console.log('Service Worker registrado:', reg))
          .catch(err => console.error('Error al registrar Service Worker:', err));
      });
    }
  </script>
</head>
<body>
  <!-- Sección principal con lista de radios -->
  <section class="sec sec-2" id="sec-2">

    <header class="header">
      <h4>Radios</h4>
      <div class="header-search">
        <input id="searchInput" type="search" placeholder="Buscar..." aria-label="Buscar estación">
        <i class="material-icons">search</i>
      </div>
      <div class="header-buttons">
        <button type="button" id="refreshBtn" onclick="refreshStations()" title="Recargar emisoras" aria-label="Recargar emisoras">
          <i class="material-icons">refresh</i>
        </button>
        <button type="button" class="dark-mode-btn" onclick="darkMood()" title="Cambiar tema oscuro/claro" aria-label="Cambiar tema oscuro/claro">
          <i class="material-icons">invert_colors</i>
        </button>
      </div>
    </header>

    <div class="music-list" id="music-list"></div>

    <!-- Audio player -->
    <audio id="audio" preload="none" crossorigin="anonymous"></audio>

    <!-- Reproductor -->
    <div class="players" id="players">
      <!-- Fondo con blur dinámico -->
      <div class="player-bg-blur" id="playerBgBlur"></div>
      
      <button type="button" class="back-btn" onclick="showplayer()" aria-label="Minimizar reproductor">
        <i class="material-icons">expand_more</i>
      </button>

      <!-- Hora grande (solo visible cuando está expandido) -->
      <div class="player-clock" id="playerClock" style="display:none;">
        <span id="playerTime">12:00 p. m.</span>
      </div>

      <div class="bottom">
        <div class="thumbnail-wrapper">
          <div class="thumbnail">
            <img id="thumbnail" src="https://i.ibb.co/D4BdW1v/microfono.png" width="60" height="60" alt="Portada" loading="lazy">
          </div>
        </div>

        <div class="content" onclick="showplayer()">
          <h3 id="name">Selecciona una radio</h3>
          <small id="category">Categoría</small>
        </div>

        <!-- Metadata de canción (solo visible cuando está expandido) -->
        <div class="player-metadata" id="playerMetadata" style="display:none;">
          <div id="nowPlaying" class="now-playing-expanded">
            <i class="material-icons">music_note</i>
            <span id="songInfo">Esperando información...</span>
          </div>
        </div>

        <!-- Información de la radio (solo visible cuando está expandido) -->
        <div class="player-info-expanded" id="playerInfoExpanded" style="display:none;">
          <h2 id="nameExpanded">Nombre de la Radio</h2>
          <p id="categoryExpanded">Ciudad • Región</p>
        </div>

        <!-- Barra de controles con animaciones -->
        <div class="player-controls-expanded" id="playerControlsExpanded" style="display:none;">
          <button type="button" class="control-icon-btn" onclick="prevPlay()" aria-label="Anterior">
            <i class="material-icons">skip_previous</i>
          </button>
          
          <button type="button" class="play-btn-circle" onclick="playPause(event)" aria-label="Reproducir/Pausar">
            <div class="pulse-ring"></div>
            <div class="pulse-ring-2"></div>
            <i id="playBtnExpanded" class="material-icons">play_arrow</i>
          </button>
          
          <button type="button" class="control-icon-btn" onclick="nextPlay()" aria-label="Siguiente">
            <i class="material-icons">skip_next</i>
          </button>
        </div>

        <!-- Botones minificados (solo visible cuando está minimizado) -->
        <div class="btn-group">
          <button type="button" class="prevBtn" onclick="prevPlay()" aria-label="Anterior">
            <i class="material-icons">skip_previous</i>
          </button>
          <button type="button" class="playBtn" onclick="playPause(event)" aria-label="Reproducir/Pausar">
            <i id="playBtn" class="material-icons">play_arrow</i>
          </button>
          <button type="button" class="nextBtn" onclick="nextPlay()" aria-label="Siguiente">
            <i class="material-icons">skip_next</i>
          </button>
        </div>

        <!-- Control de volumen (solo visible cuando está expandido) -->
        <div class="volume-box-expanded" id="volumeBoxExpanded" style="display:none;">
          <button onclick="volumeDown()" class="volume-icon-btn" aria-label="Bajar volumen">
            <i class="material-icons">volume_down</i>
          </button>
          <div class="volume-control-expanded">
            <input type="range" class="volume-bar-expanded" id="volumeBarExpanded" step="1" value="60" min="0" max="100"
                   oninput="updateVolume(this.value)" aria-label="Volumen">
          </div>
          <button onclick="volumeUp()" class="volume-icon-btn" aria-label="Subir volumen">
            <i class="material-icons">volume_up</i>
          </button>
          <span class="volume-percentage-expanded" id="volumePercentageExpanded">60%</span>
        </div>


      </div>

      <!-- Menú de navegación debajo del reproductor -->
      <div class="player-menu">
        <button type="button" id="homeBtn" class="menu-btn active" onclick="showHome()" title="Inicio" aria-label="Inicio">
          <i class="material-icons">home</i>
          <span>Inicio</span>
        </button>
        <button type="button" id="localesBtn" class="menu-btn" onclick="showLocales()" title="Locales" aria-label="Locales">
          <i class="material-icons">place</i>
          <span>Locales</span>
        </button>
        <button type="button" id="worldBtn" class="menu-btn" onclick="showWorld()" title="World" aria-label="World">
          <i class="material-icons">language</i>
          <span>World</span>
        </button>
        <button type="button" id="favoritesBtn" class="menu-btn" onclick="showFavorites()" title="Favoritos" aria-label="Favoritos">
          <i class="material-icons">favorite</i>
          <span>Favoritos</span>
        </button>
      </div>
    </div>
  </section>

</body>
</html>
